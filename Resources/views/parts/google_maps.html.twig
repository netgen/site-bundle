<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3.exp&amp;sensor=false"></script>
<script type="text/javascript">
    function initializeGoogleMaps( options ) {
        var defaults = {
            containerId: "0",
            latitude: {{ ezpublish.configResolver.parameter( 'google_maps.latitude', 'ngmore' )|raw|escape( 'js' ) }},
            longitude: {{ ezpublish.configResolver.parameter( 'google_maps.longitude', 'ngmore' )|raw|escape( 'js' ) }},
            zoom: {{ ezpublish.configResolver.parameter( 'google_maps.zoom', 'ngmore' )|raw|escape( 'js' ) }},
            mapType: "{{ ezpublish.configResolver.parameter( 'google_maps.map_type', 'ngmore' )|raw|escape( 'js' ) }}"
        };

        options = $.extend({}, defaults, options || {});

        var mapCenter = new google.maps.LatLng(
            options.latitude > 90 || options.latitude < -90 ? defaults.latitude : options.latitude,
            options.longitude > 180 || options.longitude < -180 ? defaults.longitude : options.longitude
        );

        var mapOptions = {
            zoom: options.zoom > 21 || options.zoom < 0 ? defaults.zoom : options.zoom,
            center: mapCenter,
            mapTypeId: google.maps.MapTypeId[options.mapType]
        };

        var map = new google.maps.Map(document.getElementById('map-canvas-' + options.containerId), mapOptions);

        var marker = new google.maps.Marker({
            position: mapCenter,
            map: map
        });
    }
</script>

<script type="text/javascript">
    var mapOptions = {
        {% if container_id is defined and container_id is not empty %}containerId: "{{ container_id|raw|escape( 'js' ) }}",{% endif %}
        {% if latitude is defined and latitude is not empty %}latitude: {{ latitude|raw|escape( 'js' ) }},{% endif %}
        {% if longitude is defined and longitude is not empty %}longitude: {{ longitude|raw|escape( 'js' ) }},{% endif %}
        {% if zoom is defined and zoom is not empty %}zoom: {{ zoom|raw|escape( 'js' ) }},{% endif %}
        {% if map_type is defined and map_type is not empty %}mapType: "{{ map_type|raw|escape( 'js' ) }}"{% endif %}
    };

    google.maps.event.addDomListener(window, 'load', function(){ initializeGoogleMaps( mapOptions ); });
</script>

<div id="map-canvas-{{ container_id|default( 0 )|raw|escape( 'js' ) }}" class="google-maps" style="height:{{ map_height|default( 560 )|raw|escape( 'js' ) }}px; width:100%;"></div>
